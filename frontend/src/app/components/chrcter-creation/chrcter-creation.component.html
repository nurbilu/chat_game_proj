<div class="chrcter-creation-container container">
  <div *ngIf="isLoading" class="progress-container">
    <ngb-progressbar type="info" [value]="progressValue" [animated]="true"
      [striped]="true">{{progressValue}}% please wait - loading</ngb-progressbar>
  </div>
  <div class="grid">
    <div class="g-col-4 text-frame1">
      <h2>Welcome to Character Creation </h2>
      <p>Hello there, traveler! My name is DeMe, and I'll be your chat-like adventure guide and Game Manager. What combat
        style do you desire? There are many classes and races to choose from in DnD 5e. create a prompt to paste at the
        chat!
        <br>
        use this Text Editor to create your character creation prompt , also use the chat to ask me questions about your
        character , dont
        forget to use our library and the accordions
        to see the classes and races descriptions and spells:
      </p>
    </div>
    <div class="g-col-8 text-frame1">
  <h3>Library Search</h3>
  <div class="input-group">
    <input type="text" [(ngModel)]="searchQuery" placeholder="Search..." class="form-control">
    <button (click)="onSearch()" class="search-icon" alt="Search" ngbPopover="Click to search" triggers="mouseenter:mouseleave" popoverTitle="Search"></button>
    <button class="clear-icon" (click)="clearSearchQuery()" alt="clear-input" ngbPopover="Clear search query" triggers="mouseenter:mouseleave" popoverTitle="Clear"></button>
    <button class="clear-results" (click)="clearSearchResults()" alt="clear-results" ngbPopover="Clear search results" triggers="mouseenter:mouseleave" popoverTitle="Clear Results"></button>
  </div>
  <div *ngIf="isLoading" class="spinner-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  <div *ngIf="showSearchResults && !isLoading">
    <app-lib-search [searchResult]="searchResult" (searchCompleted)="handleSearchResults($event)" (searchCleared)="clearSearchResults()"></app-lib-search>
  </div>
  <button class="clear-results" (click)="clearSearchResults()" alt="clear-results"></button>
</div>

    <div class="g-col-8 text-frame">
      <h3>Character Creation Prompt</h3>
      <div class="text-editor-container">
        <st-editor [(ngModel)]="characterPrompt" [Config]="config"></st-editor>
      </div>
      <button (click)="sendMessage()" ngbPopover="Click to save your prompt to the chat" triggers="mouseenter:mouseleave" popoverTitle="Send">Send</button>
      <button (click)="saveDraft()" ngbPopover="Click to save draft not as a prompt" triggers="mouseenter:mouseleave" popoverTitle="Save Draft">Save Draft</button>
      <button (click)="pasteDraft()" ngbPopover="Click to paste your draft" triggers="mouseenter:mouseleave" popoverTitle="Paste Draft">Paste Draft</button>
    </div>

    <div class="g-col-4 text-frame1">
      <h3>Spells for Each Class</h3>
      <div *ngFor="let classItem of classes">
        <ng-container *ngIf="!['Barbarian', 'Fighter', 'Monk', 'Rogue'].includes(classItem.name)">
          <h4>{{ classItem?.name }}</h4>
          <div class="select-container">
            <select *ngIf="classItem.spells.length > 0" class="form-select" #spellSelect (change)="onSpellSelectChange($event, classItem.name)">
              <option value="">Select a spell</option>
              <option *ngFor="let spell of classItem?.spells" [value]="spell">{{ spell }}</option>
            </select>
            <img src="/assets/imgs/icons/copy.png" class="copy-icon" (click)="copySelectedSpell(selectedSpell) " ngbPopover="Click to copy the selected spell" triggers="mouseenter:mouseleave" popoverTitle="Copy">
          </div>
          <p *ngIf="classItem?.spells?.length === 0" class="no-spells">
            No spells available for {{ classItem?.name }}.
          </p>
        </ng-container>
      </div>
      <div>
        <h3>Non-Spell Classes</h3>
        <p>No spells available for these classes!</p>
        <ul>
          <li>Barbarian</li>
          <li>Fighter</li>
          <li>Monk</li>
          <li>Rogue</li>
        </ul>
      </div>
      <p>
        For more information on spells, visit
        <a href="https://rpgbot.net/dnd5/characters/spells/" target="_blank">RPGBot spells</a>.
      </p>
    </div>

    <div class="g-col-8 text-frame1 classes-description">
      <h3>Classes Description</h3>
      <div ngbAccordion>
        <div ngbAccordionItem *ngFor="let class of classes">
          <h2 ngbAccordionHeader>
            <button ngbAccordionButton>{{ class.name }}</button>
          </h2>
          <div ngbAccordionCollapse>
            <div ngbAccordionBody >
              <p>{{ class.description }}</p>
              <h5 *ngIf="isSpellCaster(class.name)"></h5>
              <div class="table-responsive" *ngIf="isSpellCaster(class.name)">
                <h5>Spell Slot Levels for {{class.name}}:</h5>
                <table class="table table-striped table-bordered">
                  <thead>
                    <tr>
                      <th>Level</th>
                      <th *ngFor="let slotLevel of [1,2,3,4,5,6,7,8,9]">Spell Slot Level {{slotLevel}}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let level of levels">
                      <td>{{level}}</td>
                      <td *ngFor="let slotLevel of [1,2,3,4,5,6,7,8,9]">
                        <ng-container *ngIf="getSpellSlotLevels(class.name, level)[slotLevel - 1]">
                          {{ getSpellSlotLevels(class.name, level)[slotLevel - 1].slots }}
                        </ng-container>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <p>
          For more information on classes, visit
          <a href="https://rpgbot.net/dnd5/characters/classes/" target="_blank">RPGBot classes</a>.
        </p>
      </div>
    </div>

    <div class="g-col-4 text-frame1">
      <h3>Race Descriptions</h3>
      <div ngbAccordion>
        <div ngbAccordionItem *ngFor="let race of races">
          <h2 ngbAccordionHeader>
            <button ngbAccordionButton>{{ race.name }}</button>
          </h2>
          <div ngbAccordionCollapse>
            <div ngbAccordionBody>
              <p><strong>Alignment:</strong> {{ race.alignment }}</p>
              <p><strong>Age:</strong> {{ race.age }}</p>
              <p><strong>Size:</strong> {{ race.size_description }}</p>
              <p><strong>Languages:</strong> {{ race.language_desc }}</p>
            </div>
          </div>
        </div>
      </div>
      <div>
        <p>
          For more information on races, visit
          <a href="https://rpgbot.net/dnd5/characters/races/" target="_blank">RPGBot races</a>.
        </p>
      </div>
    </div>
  </div>
</div>

