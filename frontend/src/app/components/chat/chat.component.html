<div class="chat-container">
  <div class="chat-area">
    <h2>D&D Adventure Chat</h2>
    <div *ngIf="!username">
    </div>
    <div *ngIf="username">
      <div class="chat-window">
        <div *ngFor="let response of responses"
          [ngClass]="{'user-message': response.from === 'user', 'bot-response': response.from === 'bot'}">
          <p>{{ response.text }}</p>
        </div>
      </div>
      <div class="input-container">
        <span>{{ username }}: </span>
        <input type="text" [(ngModel)]="message" placeholder="Type your message here" required
          (keydown)="onEnter($event)">
        <button (click)="sendMessage()" class="btn btn-success">Send</button>
        <button (click)="clearChatInput()" class="clear-icon" alt="clear-input" ngbPopover="Clear the chat input" triggers="mouseenter:mouseleave" popoverTitle="Clear Chat Input"></button>
        <select [(ngModel)]="selectedTemplate" (change)="pasteTemplate()" aria-label="Default select example">
          <option value="" disabled selected>Select a template</option>
          <option value="template1">Lets Start a Game</option>
          <option value="template2">Character Prompt</option>
          <option value="template3">Save Last Prompt</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="dice-roller">
    <h3>Dice Roller</h3>
    <div class="dice-controls">
      <div *ngFor="let dice of selectedDice; let i = index">
        <select [(ngModel)]="selectedDice[i]" ngbPopover="Select the type of dice to roll" triggers="mouseenter:mouseleave" popoverTitle="Select Dice Type">
          <option *ngFor="let diceType of diceTypes" [value]="diceType">{{diceType}}</option>
        </select>
        <input type="number" [(ngModel)]="numDice[i]" min="1" max="10" ngbPopover="Select the number of dice to roll" triggers="mouseenter:mouseleave" popoverTitle="Select Number of Dice">
      </div>
      <button (click)="addDiceType()">Add Dice Type</button>
      <input type="number" [(ngModel)]="modifier" placeholder="Modifier" ngbPopover="Select the modifier to add to the roll" triggers="mouseenter:mouseleave" popoverTitle="Select Modifier">
      <div class="additional-modifiers">
        <div *ngFor="let mod of additionalModifiers; let i = index">
          <input type="number" [(ngModel)]="additionalModifiers[i]" placeholder="Additional Modifier {{i + 1}}" ngbPopover="Select an additional modifier to add to the roll" triggers="mouseenter:mouseleave" popoverTitle="Select Additional Modifier">
        </div>
      </div>
      <button (click)="addAdditionalModifier()">Add Additional Modifier</button>
      <button (click)="rollDice()">Roll</button>
      <button (click)="clearRollResults()">Clear Results</button>
    </div>
    <div class="dice-results" *ngIf="rollResults.length">
      <p>Dice: {{numDice.join(', ')}} {{selectedDice.join(', ')}}</p>
      <p>Results: {{rollResults.join(', ')}} + ({{modifier}}) + ({{additionalModifiers.join(' + ')}})</p>
      <p>Total with Modifiers: {{rollTotal}}</p>
    </div>
  </div>
</div>